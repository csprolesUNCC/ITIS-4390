<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Search - Whole Foods Shop</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="app.css">
  <script src="/data/data_api.js"></script>
</head>
<body class="bg-black">
  <div class="mobile-container flex flex-col">
    <div class="px-6 pt-6 pb-4 flex items-center">
      <a href="home.html" class="text-white mr-3">‚Üê</a>
      <h1 class="text-white text-2xl font-light ml-3">Search</h1>
    </div>

    <div class="content-area pt-0 px-6 pb-20">
      <div class="mb-4">
        <label for="search-input" class="sr-only">Search products</label>
        <div class="flex items-center bg-black border border-gray-700 rounded-full px-3 py-2">
          <span class="text-gray-400 mr-2">üîé</span>
          <input id="search-input" type="text" placeholder="Search for products..." class="bg-transparent text-sm text-white placeholder:text-gray-500 flex-1 focus:outline-none"/>
        </div>
      </div>

      <div id="results" class="grid grid-cols-2 gap-3"></div>
    </div>

    <nav class="absolute bottom-0 left-0 right-0 max-w-sm mx-auto bg-green-800 text-white flex justify-around py-3">
      <a href="home.html" class="flex flex-col items-center text-xs">
        <span class="text-lg">üè†</span>
        Home
      </a>
      <a href="shop.html" class="flex flex-col items-center text-xs">
        <span class="text-lg">üõí</span>
        Shop
      </a>
      <a href="search.html" class="flex flex-col items-center text-xs text-green-300">
        <span class="text-lg">üîé</span>
        Search
      </a>
      <a href="profile.html" class="flex flex-col items-center text-xs">
        <span class="text-lg">üë§</span>
        Profile
      </a>
    </nav>
  </div>

  <script>
    const PRODUCT_IMAGE_MAP = {
      101: 'img/bananas.png',
      102: 'img/honeycrisp_apple.png',
      103: 'img/baby_spinach.png',
      201: 'img/85lean_beef.png',
      202: 'img/salmon.png',
      203: 'img/free_range_chicken.png',
      301: 'img/milk.png',
      302: 'img/eggs.png',
      303: 'img/greek_yogurt.png',
      401: 'img/sourdough.png',
      801: 'img/rotisserie_chicken.png'
    };

    async function initSearch() {
      await DataAPI.loadEverything();

      const input = document.getElementById('search-input');
      const resultsEl = document.getElementById('results');

      function renderResults(list) {
        resultsEl.innerHTML = '';

        if (!list.length) {
          resultsEl.innerHTML = '<p class="text-gray-400 col-span-2 text-sm">No products found.</p>';
          return;
        }

        for (const p of list) {
          const price = DataAPI.getEffectivePrice(p) || { display: p.variants?.[0]?.price_display || '' };

          const imgSrc =
            PRODUCT_IMAGE_MAP[p.id] ||
            p.image_url ||
            'img/placeholder.png';

          resultsEl.innerHTML += `
            <a href="product.html?id=${p.id}" class="bg-gray-900 border border-gray-800 rounded-lg p-3 flex flex-col">
              <div class="h-24 bg-gray-700 rounded-md mb-2 overflow-hidden">
                <img src="${imgSrc}" alt="${p.name}" class="w-full h-full object-cover" onerror="this.src='img/placeholder.png'">
              </div>
              <p class="text-sm text-white font-medium truncate">${p.name}</p>
              <p class="text-xs text-emerald-300 font-semibold mt-1">${price.display}</p>
            </a>
          `;
        }
      }

      renderResults(DataAPI.getAllProducts());

      input.addEventListener('input', () => {
        const q = input.value.trim();
        const results = q ? DataAPI.searchProducts(q) : DataAPI.getAllProducts();
        renderResults(results);
      });
    }

    initSearch();
  </script>
</body>
</html>